<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Air Flow Pvt. Ltd. Typing Test</title>
  <link rel="icon" type="image/png" href="https://airflow.in/wp-content/uploads/2021/12/cropped-AIR-1.png" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      background: #e6f4ff;
      color: #333;
      padding-top: 140px;
    }
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 999;
      padding: 20px 40px;
      background: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .header img {
      height: 100px;
      filter: brightness(1.2) contrast(1.3);
    }
    .header h2 {
      color: #003366;
      font-weight: 600;
      font-size: 36px;
    }
    .container, #test-area, #results, #finalSubmitBtn {
      display: none;
      max-width: 800px;
      margin: 30px auto;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 30px;
      min-height: 80vh;
    }
    .left {
      flex: 0 0 40%;
      background: url('https://static.vecteezy.com/system/resources/previews/001/883/463/original/young-man-using-desktop-computer-sitting-in-chair-with-desk-free-vector.jpg') center/cover no-repeat;
      height: 400px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .right {
      flex: 0 0 300px;
      background: #fff;
      margin-left: 30px;
      padding: 30px 25px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    .right h3 { text-align: center; margin-bottom: 15px; font-weight: 600; }
    input[type="text"], input[type="email"] {
      width: 100%;
      padding: 12px 15px;
      margin: 8px 0;
      border: 1px solid #ddd;
      border-radius: 25px;
      outline: none;
    }
    .error {
      color: red;
      font-size: 14px;
      margin-top: 5px;
      display: none;
      text-align: center;
    }
    button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 25px;
      background: linear-gradient(to right, #36d1dc, #5b86e5);
      color: white;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
      transition: opacity 0.3s;
    }
    button:disabled { opacity: 0.5; cursor: not-allowed; }

    #paragraph {
      white-space: pre-wrap;
      background: #f1f1f1;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      line-height: 1.6;
      font-size: 16px;
    }
    #typing-box {
      width: 100%;
      height: 200px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 10px;
    }
    .timer {
      text-align: right;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .highlight {
      background-color: yellow;
    }
    .correct {
      color: green;
    }
    .incorrect {
      color: red;
    }
  </style>
</head>
<body>

<div class="header">
  <img src="https://airflow.in/wp-content/uploads/2021/12/cropped-AIR-1.png" alt="Logo" />
  <h2>Air Flow Pvt. Ltd. Typing Speed Test</h2>
</div>

<!-- Login Page -->
<div class="login-container" id="loginPage">
  <div class="left"></div>
  <div class="right">
    <h3>Login</h3>
    <input type="text" id="name" placeholder="Your Name" required />
    <div class="error" id="nameError">Please enter a valid name.</div>
    <input type="email" id="email" placeholder="Your Email" required />
    <div class="error" id="emailError">Please enter a valid email.</div>
    <button onclick="startTyping()">Submit</button>
  </div>
</div>

<!-- Typing Test Area -->
<div class="container" id="test-area">
  <div class="timer" id="timer">01:00</div>
  <div id="paragraph"></div>
  <textarea id="typing-box" disabled placeholder="Start typing here..."></textarea>
</div>

<!-- Results -->
<div class="container" id="results"></div>
<div class="container"><button id="finalSubmitBtn" onclick="submitToSheet()">Submit</button></div>

<script>
  const paragraphs = [
    "The morning sun rose gently over the quiet village, casting golden hues across the rooftops...",
    "A gentle breeze rustled the leaves as she sat under the ancient oak tree...",
    "Discipline is the bridge between goals and achievement...",
    "In a world dominated by screens and instant communication...",
    "Rain poured heavily against the windows...",
    "The internet has transformed education in countless ways...",
    "The stars shimmered above like tiny lanterns in the night sky...",
    "The engine roared as the car sped down the winding road..."
  ];

  let totalDuration = 60;
  let timeLeft = totalDuration;
  let activeTimer;
  let inactivityTimer;
  let timerRunning = false;
  let selectedText = "";

  function startTyping() {
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const nameRegex = /^[a-zA-Z ]+$/;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    let valid = true;
    if (!nameRegex.test(name)) {
      document.getElementById("nameError").style.display = "block";
      valid = false;
    } else {
      document.getElementById("nameError").style.display = "none";
    }

    if (!emailRegex.test(email)) {
      document.getElementById("emailError").style.display = "block";
      valid = false;
    } else {
      document.getElementById("emailError").style.display = "none";
    }

    if (!valid) return;

    document.getElementById("loginPage").style.display = "none";
    document.getElementById("test-area").style.display = "block";

    selectedText = paragraphs[Math.floor(Math.random() * paragraphs.length)];
    renderParagraph();

    const typingBox = document.getElementById("typing-box");
    typingBox.disabled = false;
    typingBox.focus();
    timeLeft = totalDuration;
    updateTimerDisplay();

    typingBox.addEventListener("input", () => {
      clearTimeout(inactivityTimer);
      startMainTimer();
      inactivityTimer = setTimeout(() => pauseMainTimer(), 1000);
      renderParagraph();
    });
  }

  function updateTimerDisplay() {
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    document.getElementById("timer").innerText = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
  }

  function startMainTimer() {
    if (timerRunning) return;
    timerRunning = true;
    activeTimer = setInterval(() => {
      if (timeLeft <= 0) {
        clearInterval(activeTimer);
        finishTest();
        return;
      }
      timeLeft--;
      updateTimerDisplay();
    }, 1000);
  }

  function pauseMainTimer() {
    clearInterval(activeTimer);
    timerRunning = false;
  }

  function renderParagraph() {
    const typedText = document.getElementById("typing-box").value;
    let html = "";
    for (let i = 0; i < selectedText.length; i++) {
      if (i < typedText.length) {
        const correctChar = selectedText[i];
        const typedChar = typedText[i];
        if (typedChar === correctChar) {
          html += `<span class="correct">${correctChar}</span>`;
        } else {
          html += `<span class="incorrect">${correctChar}</span>`;
        }
      } else if (i === typedText.length) {
        html += `<span class="highlight">${selectedText[i]}</span>`;
      } else {
        html += `<span>${selectedText[i]}</span>`;
      }
    }
    document.getElementById("paragraph").innerHTML = html;
  }

  function finishTest() {
    pauseMainTimer();
    const typedText = document.getElementById("typing-box").value.trim();
    const originalWords = selectedText.split(/\s+/);
    const typedWords = typedText.split(/\s+/);

    let correct = 0;
    typedWords.forEach((word, i) => {
      if (word === originalWords[i]) correct++;
    });

    const wpm = Math.round((typedWords.length / totalDuration) * 60);
    const accuracy = ((correct / originalWords.length) * 100).toFixed(2);

    document.getElementById("typing-box").disabled = true;
    document.getElementById("test-area").style.display = "none";

    document.getElementById("results").innerHTML = `
      <h3>Test Result</h3>
      <p><strong>Name:</strong> ${document.getElementById("name").value}</p>
      <p><strong>Email:</strong> ${document.getElementById("email").value}</p>
      <p><strong>WPM:</strong> ${wpm}</p>
      <p><strong>Accuracy:</strong> ${accuracy}%</p>
      <p><strong>Total Words Typed:</strong> ${typedWords.length}</p>
      <p><strong>Correct Words:</strong> ${correct}</p>
    `;
    document.getElementById("results").style.display = "block";
    document.getElementById("finalSubmitBtn").style.display = "block";

    window.resultData = {
      name: document.getElementById("name").value,
      email: document.getElementById("email").value,
      wpm,
      accuracy,
      totalWords: typedWords.length,
      correctWords: correct
    };
  }

  function submitToSheet() {
    const formBaseURL = "https://docs.google.com/forms/d/e/1FAIpQLSdrV_MCvdC0-v-EY9QLUAcUh15cAX-0Cbc8pbmyqEcSswuwFQ/formResponse";
    const params = new URLSearchParams({
      "entry.1239245755": window.resultData.name,
      "entry.1202560839": window.resultData.email,
      "entry.1945685852": window.resultData.wpm,
      "entry.710656876": window.resultData.accuracy,
      "entry.1233596875": window.resultData.totalWords,
      "entry.1193619231": window.resultData.correctWords
    });

    fetch(`${formBaseURL}?${params.toString()}`, {
      method: "POST",
      mode: "no-cors",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded"
      }
    })
    .then(() => {
      alert("✅ Submitted successfully!");
      location.reload();
    })
    .catch((error) => {
      alert("❌ Submission failed.");
      console.error("Error:", error);
    });
  }
</script>
</body>
</html>
