<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Air Flow Pvt. Ltd. Comprehension Test</title>
  <link rel="icon" type="image/png" href="https://airflow.in/wp-content/uploads/2021/12/cropped-AIR-1.png">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #eaf6ff;
      color: #333;
    }

    header {
      display: flex;
      align-items: center;
      padding: 20px;
      background: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    header img {
      height: 60px;
      margin-right: 20px;
    }

    header h1 {
      font-size: 24px;
      color: #0a3d62;
      margin: 0;
    }

    .main-container {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px;
    }

    .illustration {
      max-width: 500px;
      padding: 20px;
    }

    .illustration img {
      width: 100%;
    }

    .login-card {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      max-width: 350px;
      width: 100%;
      margin-left: 40px;
    }

    .login-card h2 {
      margin-top: 0;
      text-align: center;
    }

    input {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border: 1px solid #ccc;
      border-radius: 20px;
      font-size: 16px;
    }

    button {
      width: 100%;
      padding: 10px;
      margin-top: 20px;
      background: linear-gradient(to right, #00c6ff, #0072ff);
      border: none;
      border-radius: 20px;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    .container, #test-area, #results, #finalSubmitBtn {
      display: none;
      max-width: 800px;
      margin: 30px auto;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    #paragraph {
      white-space: pre-wrap;
      background: #f1f1f1;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    #typing-box {
      width: 100%;
      height: 200px;
      padding: 10px;
      font-size: 16px;
    }

    .highlight {
      background-color: #ffeaa7;
      font-weight: bold;
    }

    .timer {
      text-align: right;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .error {
      color: red;
      font-size: 14px;
      display: none;
    }
  </style>
</head>
<body>

<header>
  <img src="https://airflow.in/wp-content/uploads/2021/12/cropped-AIR-1.png" alt="logo">
  <h1>Air Flow Pvt. Ltd. Comprehension Test</h1>
</header>

<div class="main-container" id="loginPage">
  <div class="illustration">
    <img src="https://cdni.iconscout.com/illustration/premium/thumb/employee-working-on-computer-4652212-3862973.png" alt="illustration">
  </div>
  <div class="login-card">
    <h2>Login</h2>
    <input type="text" id="name" placeholder="Your Name" />
    <div class="error" id="nameError">Please enter a valid name.</div>
    <input type="email" id="email" placeholder="Your Email" />
    <div class="error" id="emailError">Please enter a valid email.</div>
    <button onclick="startTyping()">Submit</button>
  </div>
</div>

<div class="container" id="test-area">
  <div class="timer" id="timer">1:00</div>
  <div id="paragraph"></div>
  <textarea id="typing-box" disabled placeholder="Start typing here..."></textarea>
</div>

<div class="container" id="results"></div>
<div class="container"><button id="finalSubmitBtn" onclick="submitToSheet()">Submit</button></div>

<script>
  const paragraphs = [
    "The morning sun rose gently over the quiet village, casting golden hues across the rooftops...",
    "A gentle breeze rustled the leaves as she sat under the ancient oak tree...",
    "Discipline is the bridge between goals and achievement...",
    "In a world dominated by screens and instant communication...",
    "Rain poured heavily against the windows...",
    "The internet has transformed education in countless ways...",
    "The stars shimmered above like tiny lanterns in the night sky...",
    "The engine roared as the car sped down the winding road..."
  ];

  let totalDuration = 60;
  let timeLeft = totalDuration;
  let activeTimer;
  let inactivityTimer;
  let timerRunning = false;
  let selectedText = "";

  function startTyping() {
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const nameRegex = /^[a-zA-Z ]+$/;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    let valid = true;
    if (!nameRegex.test(name)) {
      document.getElementById("nameError").style.display = "block";
      valid = false;
    } else {
      document.getElementById("nameError").style.display = "none";
    }

    if (!emailRegex.test(email)) {
      document.getElementById("emailError").style.display = "block";
      valid = false;
    } else {
      document.getElementById("emailError").style.display = "none";
    }

    if (!valid) return;

    document.getElementById("loginPage").style.display = "none";
    document.getElementById("test-area").style.display = "block";

    selectedText = paragraphs[Math.floor(Math.random() * paragraphs.length)];
    renderParagraph();

    const typingBox = document.getElementById("typing-box");
    typingBox.disabled = false;
    typingBox.focus();
    timeLeft = totalDuration;
    updateTimerDisplay();

    typingBox.addEventListener("input", () => {
      clearTimeout(inactivityTimer);
      startMainTimer();
      inactivityTimer = setTimeout(() => pauseMainTimer(), 2000);
      renderParagraph();
    });
  }

  function updateTimerDisplay() {
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    document.getElementById("timer").innerText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
  }

  function startMainTimer() {
    if (timerRunning) return;
    timerRunning = true;
    activeTimer = setInterval(() => {
      if (timeLeft <= 0) {
        clearInterval(activeTimer);
        finishTest();
        return;
      }
      timeLeft--;
      updateTimerDisplay();
    }, 1000);
  }

  function pauseMainTimer() {
    clearInterval(activeTimer);
    timerRunning = false;
  }

  function renderParagraph() {
    const typedText = document.getElementById("typing-box").value;
    let html = "";
    for (let i = 0; i < selectedText.length; i++) {
      if (i < typedText.length) {
        html += `<span style="color:#333">${selectedText[i]}</span>`;
      } else if (i === typedText.length) {
        html += `<span class="highlight">${selectedText[i]}</span>`;
      } else {
        html += `<span>${selectedText[i]}</span>`;
      }
    }
    document.getElementById("paragraph").innerHTML = html;
  }

  function finishTest() {
    pauseMainTimer();
    const typedText = document.getElementById("typing-box").value.trim();
    const originalWords = selectedText.split(/\s+/);
    const typedWords = typedText.split(/\s+/);

    let correct = 0;
    typedWords.forEach((word, i) => {
      if (word === originalWords[i]) correct++;
    });

    const wpm = Math.round((typedWords.length / totalDuration) * 60);
    const accuracy = ((correct / originalWords.length) * 100).toFixed(2);

    document.getElementById("typing-box").disabled = true;
    document.getElementById("test-area").style.display = "none";

    document.getElementById("results").innerHTML = `
      <h3>Test Result</h3>
      <p><strong>Name:</strong> ${document.getElementById("name").value}</p>
      <p><strong>Email:</strong> ${document.getElementById("email").value}</p>
      <p><strong>WPM:</strong> ${wpm}</p>
      <p><strong>Accuracy:</strong> ${accuracy}%</p>
      <p><strong>Total Words Typed:</strong> ${typedWords.length}</p>
      <p><strong>Correct Words:</strong> ${correct}</p>
    `;
    document.getElementById("results").style.display = "block";
    document.getElementById("finalSubmitBtn").style.display = "block";

    window.resultData = {
      name: document.getElementById("name").value,
      email: document.getElementById("email").value,
      wpm,
      accuracy,
      totalWords: typedWords.length,
      correctWords: correct
    };
  }

  function submitToSheet() {
    const formBaseURL = "https://docs.google.com/forms/d/e/1FAIpQLSdrV_MCvdC0-v-EY9QLUAcUh15cAX-0Cbc8pbmyqEcSswuwFQ/formResponse";
    const params = new URLSearchParams({
      "entry.1239245755": window.resultData.name,
      "entry.1202560839": window.resultData.email,
      "entry.1945685852": window.resultData.wpm,
      "entry.710656876": window.resultData.accuracy,
      "entry.1233596875": window.resultData.totalWords,
      "entry.1193619231": window.resultData.correctWords
    });

    fetch(`${formBaseURL}?${params.toString()}`, {
      method: "POST",
      mode: "no-cors",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded"
      }
    })
    .then(() => {
      alert("✅ Submitted successfully!");
      location.reload();
    })
    .catch((error) => {
      alert("❌ Submission failed.");
      console.error("Error:", error);
    });
  }
</script>
</body>
</html>
