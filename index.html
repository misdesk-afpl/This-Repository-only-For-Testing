<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Air Flow Pvt. Ltd. Typing Speed Test</title>
  <link rel="icon" type="image/png" href="https://airflow.in/wp-content/uploads/2021/12/cropped-AIR-1.png" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      background: #e6f4ff;
      color: #333;
      padding-top: 140px;
    }
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 999;
      padding: 20px 40px;
      background: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .header img {
      height: 100px;
      filter: brightness(1.2) contrast(1.3);
    }
    .header h2 {
      color: #003366;
      font-weight: 600;
      font-size: 36px;
    }
    .container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 30px;
      min-height: 80vh;
    }
    .left {
      flex: 0 0 40%;
      background: url('https://static.vecteezy.com/system/resources/previews/001/883/463/original/young-man-using-desktop-computer-sitting-in-chair-with-desk-free-vector.jpg') center/cover no-repeat;
      height: 400px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .right {
      flex: 0 0 300px;
      background: #fff;
      margin-left: 30px;
      padding: 30px 25px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    h3 { text-align: center; margin-bottom: 15px; font-weight: 600; }
    input, textarea, button {
      width: 100%;
      margin: 10px 0;
      padding: 12px 15px;
      border-radius: 25px;
      border: 1px solid #ddd;
      font-size: 16px;
      outline: none;
    }
    textarea {
      height: 200px;
      resize: none;
    }
    button {
      background: linear-gradient(to right, #36d1dc, #5b86e5);
      color: white;
      cursor: pointer;
      font-weight: bold;
      transition: opacity 0.3s;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .error {
      color: red;
      font-size: 14px;
      display: none;
      text-align: center;
    }
    .timer {
      text-align: right;
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 10px;
    }
    #paragraph {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 10px;
      line-height: 1.6;
      margin-bottom: 10px;
      white-space: pre-wrap;
    }
    .highlight {
      background-color: #00b894;
      color: black;
      font-weight: bold;
    }
    .results {
      background-color: #fff;
      padding: 20px;
      margin-top: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>

<div class="header">
  <img src="https://airflow.in/wp-content/uploads/2021/12/cropped-AIR-1.png" alt="Logo" />
  <h2>Air Flow Pvt. Ltd. Typing Speed Test</h2>
</div>

<div class="container">
  <div class="left"></div>
  <div class="right">
    <h3>Typing Test</h3>
    <div id="user-info">
      <input type="text" id="name" placeholder="Your Name" />
      <div class="error" id="nameError">Please enter a valid name.</div>
      <input type="email" id="email" placeholder="Your Email" />
      <div class="error" id="emailError">Please enter a valid email.</div>
      <button id="startBtn">Start Test</button>
    </div>

    <div id="test-area" style="display:none;">
      <div class="timer" id="timer">1:00</div>
      <div id="paragraph"></div>
      <textarea id="typing-box" disabled placeholder="Start typing here..."></textarea>
    </div>

    <div class="results" id="results" style="display:none;"></div>
    <button id="finalSubmitBtn" style="display:none;">Submit</button>
  </div>
</div>

<script>
  const paragraphs = [
    `The morning sun rose gently over the quiet village, casting golden hues across the rooftops...`,
    `A gentle breeze rustled the leaves as she sat under the ancient oak tree, reading her favorite book...`,
    `Discipline is the bridge between goals and achievement. Without consistent effort...`,
    `In a world dominated by screens and instant communication...`,
    `Rain poured heavily against the windows, creating a rhythmic tapping...`,
    `The internet has transformed education in countless ways...`,
    `The stars shimmered above like tiny lanterns in the night sky...`,
    `The engine roared as the car sped down the winding road...`
  ];

  let totalDuration = 60;
  let timeLeft = totalDuration;
  let activeTimer;
  let inactivityTimer;
  let timerRunning = false;
  let selectedText = "";

  document.getElementById("startBtn").addEventListener("click", startTyping);
  document.getElementById("finalSubmitBtn").addEventListener("click", submitToSheet);

  function updateTimerDisplay() {
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    document.getElementById("timer").innerText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
  }

  function startMainTimer() {
    if (timerRunning) return;
    timerRunning = true;
    activeTimer = setInterval(() => {
      if (timeLeft <= 0) {
        clearInterval(activeTimer);
        finishTest();
        return;
      }
      timeLeft--;
      updateTimerDisplay();
    }, 1000);
  }

  function pauseMainTimer() {
    clearInterval(activeTimer);
    timerRunning = false;
  }

  function startTyping() {
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const nameRegex = /^[a-zA-Z ]+$/;
    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;

    let valid = true;
    if (!nameRegex.test(name)) {
      document.getElementById("nameError").style.display = "block";
      valid = false;
    } else {
      document.getElementById("nameError").style.display = "none";
    }
    if (!emailRegex.test(email)) {
      document.getElementById("emailError").style.display = "block";
      valid = false;
    } else {
      document.getElementById("emailError").style.display = "none";
    }

    if (!valid) return;

    document.getElementById("user-info").style.display = "none";
    document.getElementById("test-area").style.display = "block";

    selectedText = paragraphs[Math.floor(Math.random() * paragraphs.length)];
    renderParagraph();

    const typingBox = document.getElementById("typing-box");
    typingBox.disabled = false;
    typingBox.focus();
    timeLeft = totalDuration;
    updateTimerDisplay();

    typingBox.addEventListener("input", () => {
      clearTimeout(inactivityTimer);
      startMainTimer();
      inactivityTimer = setTimeout(() => pauseMainTimer(), 2000);
      renderParagraph();
    });
  }

  function renderParagraph() {
    const typedText = document.getElementById("typing-box").value;
    let html = "";
    for (let i = 0; i < selectedText.length; i++) {
      if (i < typedText.length) {
        html += `<span style="color:#000">${selectedText[i]}</span>`;
      } else if (i === typedText.length) {
        html += `<span class="highlight">${selectedText[i]}</span>`;
      } else {
        html += `<span>${selectedText[i]}</span>`;
      }
    }
    document.getElementById("paragraph").innerHTML = html;
  }

  function finishTest() {
    pauseMainTimer();
    const typedText = document.getElementById("typing-box").value.trim();
    const originalWords = selectedText.split(/\s+/);
    const typedWords = typedText.split(/\s+/);

    let correct = 0;
    typedWords.forEach((word, i) => {
      if (word === originalWords[i]) correct++;
    });

    const wpm = Math.round((typedWords.length / totalDuration) * 60);
    const accuracy = ((correct / originalWords.length) * 100).toFixed(2);

    document.getElementById("typing-box").disabled = true;
    document.getElementById("test-area").style.display = "none";

    document.getElementById("results").innerHTML = `
      <h3>Test Result</h3>
      <p><strong>Name:</strong> ${document.getElementById("name").value}</p>
      <p><strong>Email:</strong> ${document.getElementById("email").value}</p>
      <p><strong>WPM:</strong> ${wpm}</p>
      <p><strong>Accuracy:</strong> ${accuracy}%</p>
      <p><strong>Total Words Typed:</strong> ${typedWords.length}</p>
      <p><strong>Correct Words:</strong> ${correct}</p>
    `;
    document.getElementById("results").style.display = "block";
    document.getElementById("finalSubmitBtn").style.display = "block";

    window.resultData = {
      name: document.getElementById("name").value,
      email: document.getElementById("email").value,
      wpm,
      accuracy,
      totalWords: typedWords.length,
      correctWords: correct
    };
  }

  function submitToSheet() {
    const formBaseURL = "https://docs.google.com/forms/d/e/1FAIpQLSdrV_MCvdC0-v-EY9QLUAcUh15cAX-0Cbc8pbmyqEcSswuwFQ/formResponse";
    const params = new URLSearchParams({
      "entry.1239245755": window.resultData.name,
      "entry.1202560839": window.resultData.email,
      "entry.1945685852": window.resultData.wpm,
      "entry.710656876": window.resultData.accuracy,
      "entry.1233596875": window.resultData.totalWords,
      "entry.1193619231": window.resultData.correctWords
    });

    fetch(`${formBaseURL}?${params.toString()}`, {
      method: "POST",
      mode: "no-cors",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded"
      }
    })
    .then(() => {
      alert("✅ Submitted successfully!");
      location.reload();
    })
    .catch((error) => {
      alert("❌ Submission failed.");
      console.error("Error:", error);
    });
  }
</script>

</body>
</html>
